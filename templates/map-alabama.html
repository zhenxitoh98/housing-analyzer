<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    {% include 'extensions.html'%}
      <style>
         .map-page {
            text-align:center;
         }
         .map-parent {
            margin:auto;
         }

         .header {
           text-align: center;
            font-size: 1rem;
            color: #6f7287;
            /* font-style: italic; */
            font-size: 25px;
            font-family: sans-serif;
           }

           .breadcrumbs {
                margin-top: 3rem;
           }

           .breadcrumb {
                margin-right: 0.2rem;
           }
     </style>
    <title>Alabama Heat Map</title>
      <script src="{{ url_for('static',filename='gradient.js') }}"></script>
      <script>
      function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      }

      var simplemaps_statemap_mapdata={
  main_settings: {
    //General settings
		width: "responsive", //or 'responsive'
    background_color: "#FFFFFF",
    background_transparent: "yes",
    popups: "detect",

		//State defaults
		state_description: "State description",
    state_color: "#88A4BC",
    state_hover_color: "#3B729F",
    state_url: "https://simplemaps.com",
    border_size: 1.5,
    border_color: "#ffffff",
    all_states_inactive: "no",
    all_states_zoomable: "no",

		//Location defaults
		location_description: "Location description",
    location_color: "#FF0067",
    location_opacity: 0.8,
    location_hover_opacity: 1,
    location_url: "",
    location_size: 25,
    location_type: "square",
    location_border_color: "#FFFFFF",
    location_border: 2,
    location_hover_border: 2.5,
    all_locations_inactive: "no",
    all_locations_hidden: "no",

		//Label defaults
		label_color: "#ffffff",
    label_hover_color: "#ffffff",
    label_size: 22,
    label_font: "Arial",
    hide_labels: "no",
    hide_eastern_labels: false,

		//Zoom settings
		manual_zoom: "no",
    back_image: "no",
    arrow_box: "no",
    navigation_size: "40",
    navigation_color: "#f7f7f7",
    navigation_border_color: "#636363",
    initial_back: "no",
    initial_zoom: -1,
    initial_zoom_solo: "no",
    region_opacity: 1,
    region_hover_opacity: 0.6,
    zoom_out_incrementally: "yes",
    zoom_percentage: 0.99,
    zoom_time: 0.5,

		//Popup settings
		popup_color: "white",
    popup_opacity: 0.9,
    popup_shadow: 1,
    popup_corners: 5,
    popup_font: "12px/1.5 Verdana, Arial, Helvetica, sans-serif",
    popup_nocss: "no",

		//Advanced settings
		div: "map",
    auto_load: "yes",
    rotate: "0",
    url_new_tab: "yes",
    images_directory: "default",
    import_labels: "no",
    fade_time: 0.1,
    link_text: "View Website"
  },
  state_specific: {
    "01001": {
      name: "Autauga",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01003": {
      name: "Baldwin",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01005": {
      name: "Barbour",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01007": {
      name: "Bibb",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01009": {
      name: "Blount",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01011": {
      name: "Bullock",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01013": {
      name: "Butler",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01015": {
      name: "Calhoun",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01017": {
      name: "Chambers",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01019": {
      name: "Cherokee",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01021": {
      name: "Chilton",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01023": {
      name: "Choctaw",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01025": {
      name: "Clarke",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01027": {
      name: "Clay",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01029": {
      name: "Cleburne",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01031": {
      name: "Coffee",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01033": {
      name: "Colbert",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01035": {
      name: "Conecuh",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01037": {
      name: "Coosa",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01039": {
      name: "Covington",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01041": {
      name: "Crenshaw",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01043": {
      name: "Cullman",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01045": {
      name: "Dale",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01047": {
      name: "Dallas",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01049": {
      name: "Dekalb",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01051": {
      name: "Elmore",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01053": {
      name: "Escambia",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01055": {
      name: "Etowah",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01057": {
      name: "Fayette",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01059": {
      name: "Franklin",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01061": {
      name: "Geneva",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01063": {
      name: "Greene",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01065": {
      name: "Hale",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01067": {
      name: "Henry",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01069": {
      name: "Houston",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01071": {
      name: "Jackson",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01073": {
      name: "Jefferson",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01075": {
      name: "Lamar",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01077": {
      name: "Lauderdale",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01079": {
      name: "Lawrence",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01081": {
      name: "Lee",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01083": {
      name: "Limestone",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01085": {
      name: "Lowndes",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01087": {
      name: "Macon",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01089": {
      name: "Madison",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01091": {
      name: "Marengo",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01093": {
      name: "Marion",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01095": {
      name: "Marshall",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01097": {
      name: "Mobile",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01099": {
      name: "Monroe",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01101": {
      name: "Montgomery",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01103": {
      name: "Morgan",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01105": {
      name: "Perry",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01107": {
      name: "Pickens",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01109": {
      name: "Pike",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01111": {
      name: "Randolph",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01113": {
      name: "Russell",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01115": {
      name: "St. Clair",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01117": {
      name: "Shelby",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01119": {
      name: "Sumter",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01121": {
      name: "Talladega",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01123": {
      name: "Tallapoosa",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01125": {
      name: "Tuscaloosa",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01127": {
      name: "Walker",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01129": {
      name: "Washington",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01131": {
      name: "Wilcox",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    },
    "01133": {
      name: "Winston",
      description: "default",
      color: "default",
      hover_color: "default",
      url: "default"
    }
  },
  locations: {},
  labels: {}
};


    const counties = {{ counties|tojson }};
    const min_prices = {{ min_prices|tojson }};
    const max_prices = {{ max_prices|tojson }};
    const average_prices = {{ average_prices|tojson }};
    const average_prices_per_square_feet = {{ average_prices_per_square_feet|tojson }};
    const max_price = {{ max_price|tojson }};
    const min_price = {{ min_price|tojson }};
    const zipcodes = {{ zipcodes|tojson }};
    var gradient = generateColor('#FF0000', '#add8e6', max_price - min_price + 1);
    var reverse_gradient = generateColor( '#add8e6', '#FF0000', max_price - min_price + 1);


    let maxMinPrice = Math.max(...min_prices)
    let maxMaxPrice = Math.max(...max_prices)
    let maxAveragePerSquare = Math.max(...average_prices_per_square_feet)
    let maxAverage = Math.max(...average_prices)

    let keys = Object.keys(simplemaps_statemap_mapdata['state_specific'])
    keys.forEach(key => {
        let current_county = simplemaps_statemap_mapdata['state_specific'][key]
        if (Object.keys(counties).includes(current_county['name'])) {
            let i = counties[current_county['name']]
            let index = Math.round(average_prices[counties[current_county['name']]]) - min_price
            current_county['color'] = '#' + gradient[index]
            current_county['hover_color'] = '#' + reverse_gradient[index]
            current_county['description'] = `
                <hr/>
                Average Price Per Square Foot: $${Math.round(average_prices_per_square_feet[i])}<br/>
                Minimum Housing Price: $${numberWithCommas(Math.round(min_prices[i]))}
                <br/>
                Maximum Housing Price: $${numberWithCommas(Math.round(max_prices[i]))}
                <br/>
                Zipcode: ${zipcodes[i]}
                `
        } else {
            let index = Math.round(Math.random() * (max_price - min_price));

            current_county['color'] = '#' + gradient[index]
            current_county['hover_color'] = '#' + reverse_gradient[index]
            current_county['description'] = `
                <hr/>
                <h4>Note: This county's data is randomized since it was unavailable in firebase.</h4><br/>
                Average Price Per Square Foot: $${numberWithCommas(Math.round(Math.random() * maxAveragePerSquare))}<br/>
                Minimum Housing Price: $${numberWithCommas(Math.round(Math.random() * maxMinPrice))}
                <br/>
                Maximum Housing Price: $${numberWithCommas(Math.round(Math.random() * maxMaxPrice))}
                <br/>
                Zipcode: Unavailable
            `
        }
        current_county['name'] += ' County'
    });
      </script>
    <script src="{{ url_for('static',filename='statemap-alabama.js') }}"></script>
  </head>


	<body>
        {% include 'navbar.html'%}
		<div class="map-page" style="padding-top: 30px;">
			<h3 class="header">Alabama Housing Prices</h3>
			<div class="map-parent" style="max-width: 700px;"> <!-- Keep map above fold -->
				<div id="map"></div>
			</div>
		</div>
	</body>
</html>